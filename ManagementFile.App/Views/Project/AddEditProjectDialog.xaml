<Window x:Class="ManagementFile.App.Views.Project.AddEditProjectDialog"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
        xmlns:controls="clr-namespace:ManagementFile.App.Controls"
        xmlns:converters="clr-namespace:ManagementFile.App.Converters"
        mc:Ignorable="d" 
        Title="{Binding DialogTitle}" 
        Height="950" Width="1300"
        WindowStartupLocation="CenterScreen"
        ResizeMode="CanResize"
        MinHeight="850" MinWidth="1100"
        Background="#F8F9FA"
        WindowStyle="SingleBorderWindow">
    
    <Window.Resources>

        <Style x:Key="ModernDatePicker" TargetType="DatePicker">
            <Setter Property="FontFamily" Value="Segoe UI"/>
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="Padding" Value="12,8"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="BorderBrush" Value="#BDC3C7"/>
            <Setter Property="Background" Value="White"/>
            <Setter Property="Foreground" Value="#2C3E50"/>
            <Setter Property="MinHeight" Value="40"/>
            <Setter Property="VerticalContentAlignment" Value="Center"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="DatePicker">
                        <Border Name="Border"
            Background="{TemplateBinding Background}"
            BorderBrush="{TemplateBinding BorderBrush}"
            BorderThickness="{TemplateBinding BorderThickness}"
            CornerRadius="8"
            Padding="{TemplateBinding Padding}">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>

                                <!-- DatePicker TextBox -->
                                <DatePickerTextBox Grid.Column="0"
                               x:Name="PART_TextBox"
                               Foreground="{TemplateBinding Foreground}"
                               Background="Transparent"
                               BorderThickness="0"
                               Padding="0"
                               VerticalContentAlignment="{TemplateBinding VerticalContentAlignment}"
                               HorizontalContentAlignment="Left"/>

                                <!-- Calendar Button -->
                                <Button Grid.Column="1"
                    x:Name="PART_Button"
                    Background="Transparent"
                    BorderThickness="0"
                    Padding="8,0"
                    VerticalAlignment="Stretch">
                                    <Path Data="M19,3H18V1H16V3H8V1H6V3H5C3.89,3 3,3.9 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V5A2,2 0 0,0 19,3M19,19H5V8H19V19Z"
                      Fill="#7F8C8D"
                      Width="16"
                      Height="16"
                      Stretch="Uniform"/>
                                </Button>

                                <!-- Popup for Calendar -->
                                <Popup Grid.Column="0"
                   x:Name="PART_Popup"
                   StaysOpen="False"
                   PlacementTarget="{Binding ElementName=Border}"
                   Placement="Bottom"
                   AllowsTransparency="True">
                                    <Border Background="White"
                        BorderBrush="#BDC3C7"
                        BorderThickness="1"
                        CornerRadius="8"
                        Padding="4"
                        Effect="{StaticResource DropShadowEffect}">
                                        <Calendar x:Name="PART_Calendar"/>
                                    </Border>
                                </Popup>
                            </Grid>
                        </Border>

                        <ControlTemplate.Triggers>
                            <Trigger Property="IsFocused" Value="True">
                                <Setter TargetName="Border" Property="BorderBrush" Value="#3498DB"/>
                                <Setter TargetName="Border" Property="BorderThickness" Value="2"/>
                                <Setter TargetName="Border" Property="Effect">
                                    <Setter.Value>
                                        <DropShadowEffect Color="#3498DB" Opacity="0.3" ShadowDepth="0" BlurRadius="8"/>
                                    </Setter.Value>
                                </Setter>
                            </Trigger>

                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="Border" Property="BorderBrush" Value="#3498DB"/>
                            </Trigger>

                            <Trigger Property="IsEnabled" Value="False">
                                <Setter TargetName="Border" Property="Background" Value="#F8F9FA"/>
                                <Setter Property="Foreground" Value="#7F8C8D"/>
                                <Setter TargetName="Border" Property="BorderBrush" Value="#E8E8E8"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
            <Style.Triggers>
                <DataTrigger Binding="{Binding IsViewMode}" Value="True">
                    <Setter Property="IsEnabled" Value="False"/>
                    <Setter Property="Background" Value="#F5F5F5"/>
                    <Setter Property="BorderBrush" Value="#E0E0E0"/>
                </DataTrigger>
            </Style.Triggers>
        </Style>

    </Window.Resources>
    <Grid Margin="15">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Enhanced Header Section -->
        <Border Grid.Row="0" 
                Style="{StaticResource CardStyle}">
            <Grid>

                <StackPanel>
                    <TextBlock Text="{Binding DialogTitle}"
                               FontFamily="Segoe UI"
                               FontSize="20" 
                               FontWeight="Bold" 
                               HorizontalAlignment="Center"
                               Foreground="#2C3E50"
                               Margin="0,0,0,10"/>
                    <!--<TextBlock Text="{Binding ProjectParentTitle}"
                               FontFamily="Segoe UI"
                               FontSize="16" 
                               FontWeight="Bold" 
                               HorizontalAlignment="Center"
                               Foreground="#2C3E50"
                               Margin="0,0,0,10"
                               Visibility="{Binding IsViewChildernProjects, Converter={StaticResource BooleanToVisibilityConverter}}"/>-->
                    <TextBlock Text="Các trường có dấu (*) là bắt buộc." 
                               FontFamily="Segoe UI"
                               FontSize="12"
                               Foreground="#7F8C8D"
                               Margin="0"
                               FontStyle="Italic"
                               HorizontalAlignment="Center"/>
                </StackPanel>
            </Grid>
        </Border>

        <!-- Enhanced Content ScrollViewer -->
        <ScrollViewer Grid.Row="1" 
                      VerticalScrollBarVisibility="Auto"
                      HorizontalScrollBarVisibility="Disabled"
                      PanningMode="VerticalOnly"
                      Background="Transparent"
                      Margin="0,20,0,0">
            
            <StackPanel Margin="0,0,10,0">

                <!-- Basic Information Section -->
                <Expander Style="{StaticResource ModernExpander}" IsExpanded="True">
                    <Expander.Header>
                        <TextBlock Text="📋 Thông tin cơ bản" FontSize="16" FontWeight="Bold" Foreground="#2C3E50"/>
                    </Expander.Header>
                    <StackPanel>
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="20"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>

                            <!-- Priority -->
                            <StackPanel Grid.Row="0" Grid.Column="0" Margin="0,20,0,0">
                                <TextBlock Text="Độ ưu tiên" Style="{StaticResource FieldLabel}"/>

                                <!-- Edit Mode -->
                                <ComboBox ItemsSource="{Binding PriorityItems}"
                                          DisplayMemberPath="DisplayText"
                                          SelectedValuePath="Value"
                                          SelectedValue="{Binding Priority, UpdateSourceTrigger=PropertyChanged}"
                                          Style="{StaticResource ModernComboBox}"
                                          ToolTip="Chọn độ ưu tiên cho dự án"/>

                            </StackPanel>

                            <!-- Trạng thái -->
                            <StackPanel Grid.Row="0" Grid.Column="2" Margin="0,20,0,0">
                                <TextBlock Text="Trạng thái" Style="{StaticResource FieldLabel}"/>

                                <!-- Edit Mode -->
                                <ComboBox ItemsSource="{Binding ProjectStatusItems}"
                                          DisplayMemberPath="DisplayText"
                                          SelectedValuePath="Value"
                                          SelectedValue="{Binding ProjectStatus, UpdateSourceTrigger=PropertyChanged}"
                                          Style="{StaticResource ModernComboBox}"
                                          ToolTip="Chọn trạng thái cho dự án"/>

                            </StackPanel>

                            <!-- Project Name -->
                            <StackPanel Grid.Row="1" Grid.Column="0" Grid.ColumnSpan="3" Margin="0,20,0,0">
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock Text="Tên dự án " Style="{StaticResource FieldLabel}"/>
                                    <TextBlock Text="*" 
                                               Foreground="#E74C3C" 
                                               FontWeight="Bold"/>
                                </StackPanel>

                                <!-- Edit Mode -->
                                <TextBox x:Name="ProjectNameTextBox"
                                         Text="{Binding ProjectName, UpdateSourceTrigger=PropertyChanged}"
                                         Style="{StaticResource ModernTextBox}"
                                         MaxLength="200"
                                         ToolTip="Nhập tên dự án. Tên dự án ngắn gọn"/>
                            </StackPanel>

                            <!-- Description -->
                            <StackPanel Grid.Row="2" Grid.Column="0" Grid.ColumnSpan="3" Margin="0,20,0,0">
                                <TextBlock Text="Mô tả dự án" Style="{StaticResource FieldLabel}"/>

                                <StackPanel Visibility="{Binding IsViewMode, Converter={StaticResource InverseBooleanToVisibilityConverter}}">
                                    <!-- Edit Mode -->
                                    <TextBox Text="{Binding Description, UpdateSourceTrigger=PropertyChanged}"
                                             TextWrapping="Wrap"
                                             AcceptsReturn="True"
                                             MinHeight="100"
                                             VerticalContentAlignment="Top"
                                             Style="{StaticResource ModernTextBox}"
                                             MaxLength="2000"/>
                                    <TextBlock Text="{Binding Description, Converter={StaticResource LengthToCountConverter}, ConverterParameter=2000}"
                                               FontSize="11"
                                               Foreground="#7F8C8D"
                                               FontStyle="Italic"
                                               HorizontalAlignment="Right"
                                               Margin="0,6,6,0"/>
                                </StackPanel>
                                

                                <StackPanel Visibility="{Binding IsViewMode, Converter={StaticResource BooleanToVisibilityConverter}}">
                                    <!-- UserControl với Data Binding -->
                                    <controls:PathLinkUserControl x:Name="pathLinkControl" 
                                                               TextDescription="{Binding Description, Mode=OneWay}"/>
                                </StackPanel>
                                
                                
                            </StackPanel>
                        </Grid>
                    </StackPanel>
                </Expander>

                <!-- Project Manager Section -->
                <Expander Style="{StaticResource ModernExpander}" 
                          IsExpanded="True" 
                          Visibility="{Binding IsEditMode, Converter={StaticResource InverseBooleanToVisibilityConverter}}">
                    <Expander.Header>
                        <TextBlock Text="👤 Quản lý dự án" FontSize="16" FontWeight="Bold" Foreground="#2C3E50"/>
                    </Expander.Header>

                    <Grid>
                        <StackPanel>
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="Người quản lý dự án " Style="{StaticResource FieldLabel}"/>
                                <TextBlock Text="*" 
                                               Foreground="#E74C3C" 
                                               FontWeight="Bold"/>
                            </StackPanel>

                            <!-- Edit Mode -->
                            <controls:UserSelectorControl x:Name="ManagerSelector"
                                                                  Loaded="ProjectManagerSelector_Loaded"
                                                                  SelectedUser="{Binding SelectedProjectManager, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                                                  SearchScope="{Binding ManagerSearchScope}"
                                                                  Placeholder="{Binding ManagerSearchPlaceholder}"
                                                                  IsReadOnly="{Binding IsViewMode}"/>
                        </StackPanel>
                    </Grid>
                </Expander>

                <!-- Client Information Section -->
                <Expander Style="{StaticResource ModernExpander}" IsExpanded="False">
                    <Expander.Header>
                        <TextBlock Text="🏢 Thông tin khách hàng" FontSize="16" FontWeight="Bold" Foreground="#2C3E50"/>
                    </Expander.Header>

                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="20"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>

                        <!-- Client Name -->
                        <StackPanel Grid.Row="0" Grid.Column="0">
                            <TextBlock Text="Tên khách hàng" Style="{StaticResource FieldLabel}"/>

                            <!-- Edit Mode -->
                            <TextBox Text="{Binding ClientName, UpdateSourceTrigger=PropertyChanged}"
                                         Style="{StaticResource ModernTextBox}"
                                         MaxLength="200"/>
                        </StackPanel>

                        <!-- Client ID -->
                        <StackPanel Grid.Row="0" Grid.Column="2">
                            <TextBlock Text="Mã khách hàng" Style="{StaticResource FieldLabel}"/>

                            <!-- Edit Mode -->
                            <TextBox Text="{Binding ClientId, UpdateSourceTrigger=PropertyChanged}"
                                         Style="{StaticResource ModernTextBox}"
                                         MaxLength="50"/>
                        </StackPanel>

                    </Grid>
                </Expander>

                <!-- Timeline & Budget Section -->
                <Expander Style="{StaticResource ModernExpander}" IsExpanded="True">
                    <Expander.Header>
                        <TextBlock Text="📅 Thời gian và tiến độ" FontSize="16" FontWeight="Bold" Foreground="#2C3E50"/>
                    </Expander.Header>
                    <StackPanel>
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="20"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="20"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>

                            <!-- Start Date -->
                            <StackPanel Grid.Row="0" Grid.Column="0">
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock Text="Ngày bắt đầu " Style="{StaticResource FieldLabel}"/>
                                    <TextBlock Text="*" 
                                               Foreground="#E74C3C" 
                                               FontWeight="Bold"/>
                                </StackPanel>

                                <!-- Edit Mode -->
                                <DatePicker SelectedDate="{Binding StartDate, UpdateSourceTrigger=PropertyChanged}"
                                            Style="{StaticResource ModernDatePicker}"
                                            ToolTip="Chọn ngày bắt đầu"/>

                            </StackPanel>

                            <!-- Planned End Date -->
                            <StackPanel Grid.Row="0" Grid.Column="2">
                                <TextBlock Text="Ngày kết thúc dự kiến" Style="{StaticResource FieldLabel}"/>

                                <!-- Edit Mode -->
                                <DatePicker SelectedDate="{Binding PlannedEndDate, UpdateSourceTrigger=PropertyChanged}"
                                            Style="{StaticResource ModernDatePicker}"
                                            ToolTip="Chọn ngày kết thúc dự kiến. "/>

                            </StackPanel>

                            <!-- Planned End Date -->
                            <StackPanel Grid.Row="0" Grid.Column="5">
                                <TextBlock Text="Ngày kết thúc thực tế" Style="{StaticResource FieldLabel}"/>

                                <!-- Edit Mode -->
                                <DatePicker SelectedDate="{Binding ActualEndDate, UpdateSourceTrigger=PropertyChanged}"
                                            Style="{StaticResource ModernDatePicker}"
                                            ToolTip="Chọn ngày kết thúc thực tế."/>

                            </StackPanel>

                            <!-- Project Duration Info -->
                            <Border Grid.Row="1" Grid.Column="0" Grid.ColumnSpan="5" 
                                    Margin="0,20,0,0"
                                    Background="#FFF9E6"
                                    BorderBrush="#F39C12"
                                    BorderThickness="1"
                                    CornerRadius="8"
                                    Padding="16,12"
                                    Visibility="{Binding IsViewMode, Converter={StaticResource BooleanToVisibilityConverter}}">
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Grid.Column="0" 
                                               Text="⏱️" 
                                               FontSize="18" 
                                               Margin="0,0,12,0"/>
                                    <StackPanel Grid.Column="1">
                                        <TextBlock Text="{Binding ProjectDurationText}" 
                                                   FontSize="14"
                                                   FontWeight="SemiBold"
                                                   Foreground="#D68910"/>
                                        <TextBlock Text="{Binding ProjectProgressText}" 
                                                   FontSize="12"
                                                   Foreground="#B7950B"
                                                   Margin="0,2,0,0"/>
                                    </StackPanel>
                                    <ProgressBar Grid.Column="2"
                                                 Value="{Binding ProjectProgressPercentage, Mode=OneWay}"
                                                 Maximum="100"
                                                 Width="100"
                                                 Height="8"
                                                 Margin="12,0"
                                                 VerticalAlignment="Center"
                                                 Background="#F7DC6F"
                                                 Foreground="#F39C12"/>
                                    <TextBlock Grid.Column="3" 
                                               Text="{Binding ProjectProgressPercentage, Mode=OneWay, StringFormat='{}{0:F0}%'}" 
                                               FontSize="13"
                                               FontWeight="Bold"
                                               Foreground="#D68910"/>
                                </Grid>
                            </Border>

                            <!-- Estimated Hours -->
                            <StackPanel Grid.Row="2" Grid.Column="0" Margin="0,20,0,0">
                                <TextBlock Text="Số giờ ước tính" Style="{StaticResource FieldLabel}"/>

                                <!-- Edit Mode -->
                                <TextBox Text="{Binding EstimatedHours, UpdateSourceTrigger=PropertyChanged, StringFormat=N0}"
                                          Style="{StaticResource ModernTextBox}"/>

                            </StackPanel>
                            
                            <!-- Estimated Budget -->
                            <StackPanel Grid.Row="2" Grid.Column="2" Margin="0,20,0,0">
                                <TextBlock Text="Số giờ thực tế" Style="{StaticResource FieldLabel}"/>

                                <!-- Edit Mode -->
                                <TextBox Text="{Binding ActualHours, UpdateSourceTrigger=PropertyChanged, StringFormat=N0}"
                                         Style="{StaticResource ModernTextBox}" 
                                         IsReadOnly="True"/>

                            </StackPanel>

                            <!-- Estimated Budget -->
                            <StackPanel Grid.Row="2" Grid.Column="5" Margin="0,20,0,0">
                                <TextBlock Text="Tiến độ thực hiện (%)" Style="{StaticResource FieldLabel}"/>

                                <!-- Edit Mode -->
                                <TextBox Text="{Binding Progress, UpdateSourceTrigger=PropertyChanged, StringFormat=N0}"
                                         Style="{StaticResource ModernTextBox}" />

                            </StackPanel>



                        </Grid>
                    </StackPanel>
                </Expander>


                <!-- Additional Settings Section -->
                <Expander Style="{StaticResource ModernExpander}" IsExpanded="False">
                    <Expander.Header>
                        <TextBlock Text="⚙️ Cài đặt bổ sung" FontSize="16" FontWeight="Bold" Foreground="#2C3E50"/>
                    </Expander.Header>
                    <StackPanel>
                       
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="20"/>
                                <ColumnDefinition Width="250"/>
                            </Grid.ColumnDefinitions>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>

                             <!--Tags with TagInputControl--> 
                            <StackPanel Grid.Row="0" Grid.Column="0">
                                <TextBlock Text="Tags/Từ khóa" Style="{StaticResource FieldLabel}"/>

                                 <!--Edit Mode--> 
                                <controls:TagInputControl x:Name="TagInputControl"
                                                              Tags="{Binding TagsList, Mode=TwoWay}"
                                                              IsReadOnly="{Binding IsViewMode}"
                                                              Placeholder="Nhập tag và nhấn Enter để thêm..."
                                                              MaxTags="50"
                                                              AllowDuplicates="False"/>
                            </StackPanel>

                            <!-- Project Settings -->
                            <StackPanel Grid.Row="0" Grid.Column="2" VerticalAlignment="Top">
                                <TextBlock Text="Cài đặt dự án" Style="{StaticResource FieldLabel}"/>
                                <!-- Edit Mode -->
                                <StackPanel>
                                    <CheckBox IsChecked="{Binding IsPublic}"
                                              Style="{StaticResource ModernCheckBox}"
                                              Margin="0,4,0,0">
                                        <StackPanel Orientation="Horizontal">
                                            <TextBlock Text="🌐" FontSize="16" Margin="0,0,8,0"/>
                                            <TextBlock Text="Dự án công khai"/>
                                        </StackPanel>
                                    </CheckBox>
                                </StackPanel>
                            </StackPanel>

                        </Grid>
                    </StackPanel>
                </Expander>

            </StackPanel>
        </ScrollViewer>

        <!-- Enhanced Footer Section -->
        <Border Grid.Row="2" 
                Style="{StaticResource CardStyle}">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <!-- Validation/Status Messages -->
                <StackPanel Grid.Column="0" VerticalAlignment="Center" Margin="0,0,10,0">

                    <StackPanel Visibility="{Binding HasValidationMesage, Converter={StaticResource BooleanToVisibilityConverter}}">
                        <!-- Validation Message -->
                        <Border Background="#FFEBEE"
                                BorderBrush="#E74C3C"
                                BorderThickness="1"
                                CornerRadius="8"
                                Padding="16,10">
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="⚠️" 
                                           FontSize="18" 
                                           Margin="0,0,10,0"
                                           Foreground="#E74C3C"
                                           VerticalAlignment="Center"/>
                                <TextBlock Text="{Binding ValidationMessage}"
                                           Foreground="#E74C3C"
                                           FontFamily="Segoe UI"
                                           FontSize="14"
                                           VerticalAlignment="Center"
                                           TextWrapping="Wrap"/>
                            </StackPanel>
                        </Border>
                    </StackPanel>
                   
                    <!-- Success Message -->
                    <Border Background="#D4EDDA"
                            BorderBrush="#27AE60"
                            BorderThickness="1"
                            CornerRadius="8"
                            Padding="16,10"
                            Margin="0,10,0,0"
                            Visibility="{Binding SuccessMessage, Converter={StaticResource NullToVisibilityConverter}, ConverterParameter=Inverse}">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="✅" 
                                       FontSize="18" 
                                       Margin="0,0,10,0"
                                       VerticalAlignment="Center"/>
                            <TextBlock Text="{Binding SuccessMessage}"
                                       Foreground="#155724"
                                       FontFamily="Segoe UI"
                                       FontSize="14"
                                       VerticalAlignment="Center"/>
                        </StackPanel>
                    </Border>

                    <!-- Info Message -->
                    <Border Background="#CCE7FF"
                            BorderBrush="#0066CC"
                            BorderThickness="1"
                            CornerRadius="8"
                            Padding="16,10"
                            Margin="0,10,0,0"
                            Visibility="{Binding InfoMessage, Converter={StaticResource NullToVisibilityConverter}, ConverterParameter=Inverse}">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="ℹ️" 
                                       FontSize="18" 
                                       Margin="0,0,10,0"
                                       VerticalAlignment="Center"/>
                            <TextBlock Text="{Binding InfoMessage}"
                                       Foreground="#004085"
                                       FontFamily="Segoe UI"
                                       FontSize="14"
                                       VerticalAlignment="Center"/>
                        </StackPanel>
                    </Border>
                </StackPanel>

                <!-- Action Buttons -->
                <StackPanel Grid.Column="1" 
                            Orientation="Horizontal" 
                            HorizontalAlignment="Right">

                    <!-- Loading Indicator -->
                    <StackPanel Orientation="Horizontal" 
                                VerticalAlignment="Center"
                                Margin="0,0,20,0"
                                Visibility="{Binding IsAnyLoading, Converter={StaticResource BooleanToVisibilityConverter}}">
                        <ProgressBar IsIndeterminate="True" 
                                     Width="120" 
                                     Height="6"
                                     Foreground="#3498DB"
                                     Background="#ECF0F1"
                                     BorderThickness="0"/>
                        <TextBlock Text="{Binding LoadingMessage}" 
                                   FontSize="13"
                                   Foreground="#7F8C8D"
                                   Margin="12,0,0,0"
                                   VerticalAlignment="Center"/>
                    </StackPanel>

                    <!-- View Mode Buttons -->
                    <StackPanel Orientation="Horizontal"
                                Visibility="{Binding IsViewMode, Converter={StaticResource BooleanToVisibilityConverter}}">

                        <Button Command="{Binding EditCommand}"
                                Style="{StaticResource EditButton}"
                                Margin="0,0,12,0">
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="✏️" FontSize="16" Margin="0,0,8,0"/>
                                <TextBlock Text="Chỉnh sửa"/>
                            </StackPanel>
                        </Button>
                    </StackPanel>

                    <!-- Edit/Add Mode Buttons -->
                    <StackPanel Orientation="Horizontal"
                                Visibility="{Binding IsEditableMode, Converter={StaticResource BooleanToVisibilityConverter}}">

                        <!-- Reset Button (Edit mode only) -->
                        <Button Command="{Binding ResetCommand}"
                                Style="{StaticResource SecondaryButton}"
                                Margin="0,0,12,0"
                                Visibility="{Binding IsEditMode, Converter={StaticResource BooleanToVisibilityConverter}}"
                                ToolTip="Khôi phục giá trị ban đầu">
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="🔄" FontSize="16" Margin="0,0,8,0"/>
                                <TextBlock Text="Reset"/>
                            </StackPanel>
                        </Button>

                        <!-- Save Button -->
                        <Button Command="{Binding SaveCommand}"
                                IsEnabled="{Binding IsAnyLoading, Converter={StaticResource InverseBooleanConverter}}"
                                Style="{StaticResource PrimaryButton}"
                                Margin="0,0,12,0">
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="💾" FontSize="16" Margin="0,0,8,0"/>
                                <TextBlock Text="{Binding SaveButtonText}"/>
                            </StackPanel>
                        </Button>
                    </StackPanel>

                    <!-- Cancel/Close Button -->
                    <Button Command="{Binding CancelCommand}"
                            Style="{StaticResource SecondaryButton}">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="{Binding CloseButtonIcon}" FontSize="16" Margin="0,0,8,0"/>
                            <TextBlock Text="{Binding CloseButtonText}"/>
                        </StackPanel>
                    </Button>
                </StackPanel>
            </Grid>
        </Border>
    </Grid>

    <!-- Enhanced Keyboard Shortcuts -->
    <Window.InputBindings>
        <KeyBinding Command="{Binding SaveCommand}" Key="S" Modifiers="Ctrl"/>
        <KeyBinding Command="{Binding CancelCommand}" Key="Escape"/>
        <KeyBinding Command="{Binding EditCommand}" Key="F2"/>
        <KeyBinding Command="{Binding ResetCommand}" Key="F5"/>
        <!--<KeyBinding Command="{Binding ExportCommand}" Key="E" Modifiers="Ctrl"/>-->
    </Window.InputBindings>
</Window>