<UserControl x:Class="ManagementFile.App.Views.Dashboard.SmartDashboardView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:vm="clr-namespace:ManagementFile.App.ViewModels.Dashboard"
             mc:Ignorable="d" 
             d:DesignHeight="800" d:DesignWidth="1200"
             Background="#f8f9fa">

    <UserControl.Resources>
        <BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter" />
        
        <!-- Dashboard Card Style -->
        <Style x:Key="DashboardCard" TargetType="Border">
            <Setter Property="Background" Value="White"/>
            <Setter Property="CornerRadius" Value="8"/>
            <Setter Property="Padding" Value="20"/>
            <Setter Property="Margin" Value="10"/>
            <Setter Property="Effect">
                <Setter.Value>
                    <DropShadowEffect Color="#E0E0E0" BlurRadius="10" ShadowDepth="2" Opacity="0.3"/>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Phase Metric Card Template -->
        <DataTemplate x:Key="PhaseMetricCardTemplate">
            <Border Style="{StaticResource DashboardCard}" MinHeight="180">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <!-- Header -->
                    <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,15">
                        <TextBlock Text="{Binding PhaseIcon}" 
                                   FontSize="24" 
                                   VerticalAlignment="Center" 
                                   Margin="0,0,10,0"/>
                        <StackPanel>
                            <TextBlock Text="{Binding PhaseName}" 
                                       FontSize="16" 
                                       FontWeight="Bold" 
                                       Foreground="#333"/>
                            <TextBlock Text="{Binding Status}" 
                                       FontSize="12" 
                                       Foreground="{Binding StatusColor}"/>
                        </StackPanel>
                    </StackPanel>

                    <!-- Metrics -->
                    <StackPanel Grid.Row="1">
                        <!-- Primary Metric -->
                        <StackPanel Orientation="Horizontal" Margin="0,0,0,15">
                            <TextBlock Text="{Binding PrimaryMetric}" 
                                       FontSize="14" 
                                       Foreground="#666" 
                                       VerticalAlignment="Bottom"/>
                            <TextBlock Text="{Binding PrimaryValue}" 
                                       FontSize="32" 
                                       FontWeight="Bold" 
                                       Foreground="#2196F3" 
                                       Margin="10,0,0,0"/>
                        </StackPanel>

                        <!-- Secondary Metrics -->
                        <ItemsControl ItemsSource="{Binding SecondaryMetrics}">
                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <StackPanel Orientation="Horizontal" Margin="0,2">
                                        <TextBlock Text="{Binding Label}" 
                                                   FontSize="12" 
                                                   Foreground="#666" 
                                                   Width="80"/>
                                        <TextBlock Text="{Binding Value}" 
                                                   FontSize="12" 
                                                   FontWeight="Medium" 
                                                   Foreground="#333"/>
                                    </StackPanel>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                    </StackPanel>

                    <!-- Navigation Button -->
                    <Button Grid.Row="2" 
                            Content="View Details" 
                            Command="{Binding DataContext.NavigateToPhaseCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                            CommandParameter="{Binding PhaseId}"
                            Background="#2196F3" 
                            Foreground="White" 
                            BorderThickness="0" 
                            Padding="12,6" 
                            Margin="0,10,0,0">
                        <Button.Style>
                            <Style TargetType="Button">
                                <Setter Property="Template">
                                    <Setter.Value>
                                        <ControlTemplate TargetType="Button">
                                            <Border Background="{TemplateBinding Background}" 
                                                    CornerRadius="4" 
                                                    Padding="{TemplateBinding Padding}">
                                                <ContentPresenter HorizontalAlignment="Center" 
                                                                  VerticalAlignment="Center"/>
                                            </Border>
                                            <ControlTemplate.Triggers>
                                                <Trigger Property="IsMouseOver" Value="True">
                                                    <Setter Property="Background" Value="#1976D2"/>
                                                </Trigger>
                                            </ControlTemplate.Triggers>
                                        </ControlTemplate>
                                    </Setter.Value>
                                </Setter>
                            </Style>
                        </Button.Style>
                    </Button>
                </Grid>
            </Border>
        </DataTemplate>

        <!-- Quick Action Item Template -->
        <DataTemplate x:Key="QuickActionTemplate">
            <Border Style="{StaticResource DashboardCard}" MinHeight="100">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>

                    <TextBlock Grid.Column="0" 
                               Text="{Binding Icon}" 
                               FontSize="32" 
                               VerticalAlignment="Center" 
                               Margin="0,0,15,0"/>

                    <StackPanel Grid.Column="1">
                        <TextBlock Text="{Binding Title}" 
                                   FontSize="14" 
                                   FontWeight="Bold" 
                                   Foreground="#333"/>
                        <TextBlock Text="{Binding Description}" 
                                   FontSize="12" 
                                   Foreground="#666" 
                                   TextWrapping="Wrap"/>
                        <Button Content="Execute" 
                                Command="{Binding DataContext.ExecuteQuickActionCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                CommandParameter="{Binding}"
                                Background="#4CAF50" 
                                Foreground="White" 
                                BorderThickness="0" 
                                Padding="8,4" 
                                Margin="0,8,0,0" 
                                FontSize="11"/>
                    </StackPanel>
                </Grid>
            </Border>
        </DataTemplate>

        <!-- Recent Activity Template -->
        <DataTemplate x:Key="ActivityTemplate">
            <Border Background="White" 
                    BorderBrush="#E0E0E0" 
                    BorderThickness="0,0,0,1" 
                    Padding="15,10">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <TextBlock Grid.Column="0" 
                               Text="{Binding Icon}" 
                               FontSize="16" 
                               VerticalAlignment="Center" 
                               Margin="0,0,10,0"/>

                    <StackPanel Grid.Column="1">
                        <TextBlock Text="{Binding Title}" 
                                   FontSize="13" 
                                   FontWeight="Medium" 
                                   Foreground="#333"/>
                        <TextBlock Text="{Binding Description}" 
                                   FontSize="11" 
                                   Foreground="#666"/>
                    </StackPanel>

                    <TextBlock Grid.Column="2" 
                               Text="{Binding TimeAgo}" 
                               FontSize="10" 
                               Foreground="#999" 
                               VerticalAlignment="Center"/>
                </Grid>
            </Border>
        </DataTemplate>

        <!-- System Alert Template -->
        <DataTemplate x:Key="AlertTemplate">
            <Border Background="White" 
                    BorderBrush="#E0E0E0" 
                    BorderThickness="0,0,0,1" 
                    Padding="15,10">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <Ellipse Grid.Column="0" 
                             Width="8" 
                             Height="8" 
                             Fill="{Binding LevelColor}" 
                             VerticalAlignment="Center" 
                             Margin="0,0,10,0"/>

                    <StackPanel Grid.Column="1">
                        <TextBlock Text="{Binding Title}" 
                                   FontSize="13" 
                                   FontWeight="Medium" 
                                   Foreground="#333"/>
                        <TextBlock Text="{Binding Message}" 
                                   FontSize="11" 
                                   Foreground="#666" 
                                   TextWrapping="Wrap"/>
                    </StackPanel>

                    <TextBlock Grid.Column="2" 
                               Text="{Binding TimeAgo}" 
                               FontSize="10" 
                               Foreground="#999" 
                               VerticalAlignment="Center"/>
                </Grid>
            </Border>
        </DataTemplate>
    </UserControl.Resources>

    <Grid>
        <!-- Loading Overlay -->
        <Border Background="#80FFFFFF" 
                Visibility="{Binding IsLoading, Converter={StaticResource BooleanToVisibilityConverter}}"
                Panel.ZIndex="1000">
            <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center">
                <TextBlock Text="●" FontSize="32" Foreground="#2196F3" HorizontalAlignment="Center">
                    <TextBlock.RenderTransform>
                        <RotateTransform x:Name="LoadingRotation"/>
                    </TextBlock.RenderTransform>
                    <TextBlock.Triggers>
                        <EventTrigger RoutedEvent="Loaded">
                            <BeginStoryboard>
                                <Storyboard RepeatBehavior="Forever">
                                    <DoubleAnimation Storyboard.TargetName="LoadingRotation"
                                                   Storyboard.TargetProperty="Angle"
                                                   From="0" To="360" Duration="0:0:1"/>
                                </Storyboard>
                            </BeginStoryboard>
                        </EventTrigger>
                    </TextBlock.Triggers>
                </TextBlock>
                <TextBlock Text="{Binding LoadingMessage}" 
                           FontSize="14" 
                           Foreground="#666" 
                           Margin="0,10,0,0" 
                           HorizontalAlignment="Center"/>
            </StackPanel>
        </Border>

        <ScrollViewer VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled">
            <StackPanel Margin="20">
                
                <!-- Dashboard Header -->
                <Grid Margin="0,0,0,20">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <StackPanel Grid.Column="0">
                        <TextBlock Text="🏢 Enterprise Dashboard" 
                                   FontSize="28" 
                                   FontWeight="Bold" 
                                   Foreground="#333" 
                                   Margin="0,0,0,5"/>
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="System Status: " 
                                       FontSize="14" 
                                       Foreground="#666"/>
                            <TextBlock Text="{Binding SystemStatus}" 
                                       FontSize="14" 
                                       FontWeight="Bold" 
                                       Foreground="{Binding SystemStatusColor}"/>
                            <TextBlock Text=" | " 
                                       FontSize="14" 
                                       Foreground="#666" 
                                       Margin="5,0"/>
                            <TextBlock Text="{Binding LastUpdatedDisplay}" 
                                       FontSize="14" 
                                       Foreground="#666"/>
                        </StackPanel>
                    </StackPanel>

                    <StackPanel Grid.Column="1" Orientation="Horizontal">
                        <Button Content="🔄 Refresh" 
                                Command="{Binding RefreshDashboardCommand}" 
                                Background="#2196F3" 
                                Foreground="White" 
                                BorderThickness="0" 
                                Padding="12,8" 
                                Margin="5"/>
                        <Button Content="▶ Start Monitor" 
                                Command="{Binding StartMonitoringCommand}" 
                                Background="#4CAF50" 
                                Foreground="White" 
                                BorderThickness="0" 
                                Padding="12,8" 
                                Margin="5"
                                Visibility="{Binding IsMonitoringActive, Converter={StaticResource BooleanToVisibilityConverter}, ConverterParameter=Invert}"/>
                        <Button Content="⏹ Stop Monitor" 
                                Command="{Binding StopMonitoringCommand}" 
                                Background="#FF5722" 
                                Foreground="White" 
                                BorderThickness="0" 
                                Padding="12,8" 
                                Margin="5"
                                Visibility="{Binding IsMonitoringActive, Converter={StaticResource BooleanToVisibilityConverter}}"/>
                        <Button Content="📄 Export" 
                                Command="{Binding ExportDashboardCommand}" 
                                Background="#FF9800" 
                                Foreground="White" 
                                BorderThickness="0" 
                                Padding="12,8" 
                                Margin="5"/>
                    </StackPanel>
                </Grid>

                <!-- Overall Metrics Row -->
                <Border Style="{StaticResource DashboardCard}">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>

                        <StackPanel Grid.Column="0" HorizontalAlignment="Center">
                            <TextBlock Text="👥" FontSize="32" HorizontalAlignment="Center"/>
                            <TextBlock Text="Users" FontSize="12" Foreground="#666" HorizontalAlignment="Center"/>
                            <TextBlock Text="{Binding OverallMetrics.TotalUsers}" 
                                       FontSize="24" FontWeight="Bold" Foreground="#2196F3" HorizontalAlignment="Center"/>
                        </StackPanel>

                        <StackPanel Grid.Column="1" HorizontalAlignment="Center">
                            <TextBlock Text="📋" FontSize="32" HorizontalAlignment="Center"/>
                            <TextBlock Text="Projects" FontSize="12" Foreground="#666" HorizontalAlignment="Center"/>
                            <TextBlock Text="{Binding OverallMetrics.ActiveProjects}" 
                                       FontSize="24" FontWeight="Bold" Foreground="#4CAF50" HorizontalAlignment="Center"/>
                        </StackPanel>

                        <StackPanel Grid.Column="2" HorizontalAlignment="Center">
                            <TextBlock Text="✓" FontSize="32" HorizontalAlignment="Center"/>
                            <TextBlock Text="Tasks" FontSize="12" Foreground="#666" HorizontalAlignment="Center"/>
                            <TextBlock Text="{Binding OverallMetrics.TotalTasks}" 
                                       FontSize="24" FontWeight="Bold" Foreground="#FF9800" HorizontalAlignment="Center"/>
                        </StackPanel>

                        <StackPanel Grid.Column="3" HorizontalAlignment="Center">
                            <TextBlock Text="📊" FontSize="32" HorizontalAlignment="Center"/>
                            <TextBlock Text="Completion" FontSize="12" Foreground="#666" HorizontalAlignment="Center"/>
                            <TextBlock FontSize="24" FontWeight="Bold" Foreground="#9C27B0" HorizontalAlignment="Center">
                                <TextBlock.Text>
                                    <Binding Path="OverallMetrics.CompletionRate" StringFormat="{}{0:F1}%"/>
                                </TextBlock.Text>
                            </TextBlock>
                        </StackPanel>

                        <StackPanel Grid.Column="4" HorizontalAlignment="Center">
                            <TextBlock Text="🚀" FontSize="32" HorizontalAlignment="Center"/>
                            <TextBlock Text="Health" FontSize="12" Foreground="#666" HorizontalAlignment="Center"/>
                            <TextBlock Text="{Binding OverallMetrics.PerformanceScore}" 
                                       FontSize="24" FontWeight="Bold" Foreground="#00BCD4" HorizontalAlignment="Center"/>
                        </StackPanel>
                    </Grid>
                </Border>

                <!-- Main Content Grid -->
                <Grid Margin="0,20,0,0">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="2*"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>

                    <!-- Left Column: Phase Metrics -->
                    <StackPanel Grid.Column="0">
                        <TextBlock Text="📊 Phase Overview" 
                                   FontSize="20" 
                                   FontWeight="Bold" 
                                   Foreground="#333" 
                                   Margin="10,0,0,15"/>

                        <!-- Phase Metrics Grid -->
                        <ItemsControl ItemsSource="{Binding PhaseMetrics}">
                            <ItemsControl.ItemsPanel>
                                <ItemsPanelTemplate>
                                    <UniformGrid Rows="2" Columns="3"/>
                                </ItemsPanelTemplate>
                            </ItemsControl.ItemsPanel>
                            <ItemsControl.ItemTemplate>
                                <StaticResource ResourceKey="PhaseMetricCardTemplate"/>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>

                        <!-- Quick Actions -->
                        <TextBlock Text="⚡ Quick Actions" 
                                   FontSize="20" 
                                   FontWeight="Bold" 
                                   Foreground="#333" 
                                   Margin="10,30,0,15"/>

                        <ItemsControl ItemsSource="{Binding QuickActions}">
                            <ItemsControl.ItemsPanel>
                                <ItemsPanelTemplate>
                                    <UniformGrid Rows="1" Columns="4"/>
                                </ItemsPanelTemplate>
                            </ItemsControl.ItemsPanel>
                            <ItemsControl.ItemTemplate>
                                <StaticResource ResourceKey="QuickActionTemplate"/>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                    </StackPanel>

                    <!-- Right Column: Activities & Alerts -->
                    <StackPanel Grid.Column="1" Margin="20,0,0,0">
                        
                        <!-- Recent Activities -->
                        <Border Style="{StaticResource DashboardCard}">
                            <StackPanel>
                                <TextBlock Text="🕒 Recent Activities" 
                                           FontSize="16" 
                                           FontWeight="Bold" 
                                           Foreground="#333" 
                                           Margin="0,0,0,15"/>

                                <ScrollViewer MaxHeight="300" VerticalScrollBarVisibility="Auto">
                                    <ItemsControl ItemsSource="{Binding RecentActivities}">
                                        <ItemsControl.ItemTemplate>
                                            <StaticResource ResourceKey="ActivityTemplate"/>
                                        </ItemsControl.ItemTemplate>
                                    </ItemsControl>
                                </ScrollViewer>
                            </StackPanel>
                        </Border>

                        <!-- System Alerts -->
                        <Border Style="{StaticResource DashboardCard}">
                            <StackPanel>
                                <Grid Margin="0,0,0,15">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>
                                    
                                    <StackPanel Grid.Column="0" Orientation="Horizontal">
                                        <TextBlock Text="⚠️ System Alerts" 
                                                   FontSize="16" 
                                                   FontWeight="Bold" 
                                                   Foreground="#333"/>
                                        <Border Background="#F44336" 
                                                CornerRadius="10" 
                                                Padding="6,2" 
                                                Margin="10,0,0,0"
                                                Visibility="{Binding CriticalAlertsCount, Converter={StaticResource BooleanToVisibilityConverter}}">
                                            <TextBlock Text="{Binding CriticalAlertsCount}" 
                                                       FontSize="10" 
                                                       Foreground="White" 
                                                       FontWeight="Bold"/>
                                        </Border>
                                    </StackPanel>

                                    <Button Grid.Column="1" 
                                            Content="Clear All" 
                                            Command="{Binding ClearAlertsCommand}" 
                                            Background="Transparent" 
                                            BorderThickness="1" 
                                            BorderBrush="#E0E0E0" 
                                            Padding="8,4" 
                                            FontSize="11"/>
                                </Grid>

                                <ScrollViewer MaxHeight="250" VerticalScrollBarVisibility="Auto">
                                    <ItemsControl ItemsSource="{Binding SystemAlerts}">
                                        <ItemsControl.ItemTemplate>
                                            <StaticResource ResourceKey="AlertTemplate"/>
                                        </ItemsControl.ItemTemplate>
                                    </ItemsControl>
                                </ScrollViewer>

                                <!-- No Alerts Message -->
                                <TextBlock Text="✅ No system alerts" 
                                           FontSize="12" 
                                           Foreground="#666" 
                                           HorizontalAlignment="Center" 
                                           Padding="20"
                                           Visibility="{Binding SystemAlerts.Count, Converter={StaticResource BooleanToVisibilityConverter}, ConverterParameter=Invert}"/>
                            </StackPanel>
                        </Border>
                    </StackPanel>
                </Grid>
            </StackPanel>
        </ScrollViewer>
    </Grid>
</UserControl>